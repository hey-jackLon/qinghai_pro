<template>
  <div class="container">
    <ehl-table :tabledata="tableData" @add="handleAdd" @update="handUpdate" @delete="handleDelete" />
    <ehl-dialog
      :type="type"
      :opendialog="isOpen"
      :form="form"
      :station-data="stationData"
      @closedialog="closeDialog"
      @confirm="dialogConfirm"
    />
  </div>
</template>

<script>
import ehlTable from './table'
import ehlDialog from './dialog'
import { getODRegionList, insertODRegionObject, getTollStationList } from '@/api/areamanager/index'
export default {
  components: { ehlTable, ehlDialog },
  data() {
    return {
      tableData: [
        {
          event_name: '2019年环青海湖公路国际公路自行车赛',
          time: ['2020-07-22', '2020-07-23'],
          impact: '公路1、高速2、... ',
          stations: '站点1、站点4、... ...'
        }
      ],
      isOpen: false,
      form: {
        station: []
      },
      type: '',
      stationData: null
    }
  },
  mounted() {
    this.getODRegionList()
    this.getTollStationList()
  },
  methods: {
    handleAdd(e) {
      this.isOpen = true
      this.type = 'add'
      this.form = Object.assign({})
    },
    handUpdate(e) {
      this.isOpen = true
      this.type = 'modify'
      this.form = Object.assign({ index: e.index }, e.row)
    },
    handleDelete(e) {
      this.$confirm('将删除此条记录, 是否继续?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      })
        .then(() => {
          this.tableData.splice(e.index, 1)
          this.$message({
            type: 'success',
            message: '删除成功!'
          })
        })
        .catch(() => {
          this.$message({
            type: 'info',
            message: '已取消删除'
          })
        })
    },
    closeDialog(e) {
      this.isOpen = e
    },
    dialogConfirm(e) {
      const data = {
        regionCircle: '{"type":"polygon","path":[[[11298395.54608709,4416297.23233569],[11298395.54608709,4416297.23233569],[11296255.309295105,4416602.980448831],[11295949.561181964,4416602.980448831],[11295338.064955683,4416602.980448831],[11295032.316842543,4416602.980448831],[11295032.316842543,4416908.728561971],[11294726.568729402,4416908.728561971],[11294420.82061626,4416908.728561971],[11294115.07250312,4416908.728561971],[11293809.32438998,4416908.728561971],[11292892.080050558,4416908.728561971],[11292586.331937417,4416908.728561971],[11291974.835711136,4416908.728561971],[11291669.087597996,4416908.728561971],[11290751.843258573,4416908.728561971],[11290446.095145432,4416908.728561971],[11289834.598919151,4416908.728561971],[11289528.85080601,4417214.476675112],[11288917.35457973,4417214.476675112],[11288305.858353449,4417214.476675112],[11288000.110240309,4417214.476675112],[11287388.614014026,4417214.476675112],[11287082.865900885,4417214.476675112],[11286471.369674604,4417214.476675112],[11286471.369674604,4417520.224788253],[11286165.621561464,4417520.224788253],[11285859.873448323,4417520.224788253],[11285554.125335183,4417520.224788253],[11284942.629108902,4417520.224788253],[11284331.132882621,4418131.721014534],[11283413.888543198,4418437.469127675],[11282802.392316917,4418743.217240815],[11282496.644203776,4419354.713467097],[11282496.644203776,4419660.461580237],[11282496.644203776,4419966.209693378],[11282496.644203776,4420271.957806518],[11282496.644203776,4420883.454032799],[11282496.644203776,4421189.202145941],[11282496.644203776,4421800.698372222],[11282496.644203776,4422106.446485362],[11282496.644203776,4422412.1945985025],[11282496.644203776,4422717.942711643],[11282496.644203776,4423023.690824784],[11282496.644203776,4423329.438937925],[11282802.392316917,4423329.438937925],[11283108.140430057,4423635.187051065],[11283413.888543198,4423940.935164206],[11283719.636656338,4423940.935164206],[11284331.132882621,4423940.935164206],[11284636.880995762,4423940.935164206],[11284942.629108902,4423940.935164206],[11285554.125335183,4423940.935164206],[11286165.621561464,4423940.935164206],[11286777.117787745,4423940.935164206],[11287694.362127168,4423940.935164206],[11288000.110240309,4423940.935164206],[11288611.60646659,4423635.187051065],[11289528.85080601,4423635.187051065],[11290446.095145432,4423635.187051065],[11291363.339484856,4423329.438937925],[11293197.828163698,4423023.690824784],[11294115.07250312,4423023.690824784],[11294726.568729402,4423023.690824784],[11295643.813068824,4422717.942711643],[11296255.309295105,4422412.1945985025],[11296561.057408245,4422412.1945985025],[11297172.553634526,4422412.1945985025],[11297478.301747667,4422412.1945985025],[11298089.79797395,4422106.446485362],[11298395.54608709,4422106.446485362],[11298395.54608709,4421800.698372222],[11298701.29420023,4421800.698372222],[11299007.04231337,4421800.698372222],[11299312.790426511,4421800.698372222],[11300535.782879073,4421189.202145941],[11301758.775331637,4420577.705919659],[11302370.271557918,4419966.209693378],[11302676.019671058,4419966.209693378],[11302981.767784199,4419966.209693378],[11302981.767784199,4420271.957806518],[11303287.51589734,4420271.957806518],[11304204.76023676,4420883.454032799],[11304816.256463042,4420883.454032799],[11305122.004576184,4421189.202145941],[11305733.500802465,4421494.950259081],[11306039.248915605,4421800.698372222],[11306344.997028746,4421800.698372222],[11306650.745141886,4421800.698372222],[11306956.493255027,4422106.446485362],[11306956.493255027,4422412.1945985025],[11307567.989481308,4422412.1945985025],[11308179.485707588,4423023.690824784],[11308485.233820729,4423023.690824784],[11309096.730047012,4423329.438937925],[11310013.974386433,4423940.935164206],[11310931.218725855,4424246.683277346],[11312154.211178418,4424552.431390488],[11312459.959291559,4424858.179503628],[11313377.20363098,4425163.9276167685],[11313682.95174412,4425163.9276167685],[11314600.196083542,4425163.9276167685],[11315211.692309823,4425163.9276167685],[11316128.936649246,4425163.9276167685],[11316434.684762387,4425163.9276167685],[11317351.929101808,4425163.9276167685],[11318574.92155437,4425163.9276167685],[11319186.417780653,4424858.179503628],[11320409.410233214,4424552.431390488],[11321020.906459495,4424552.431390488],[11322855.39513834,4424246.683277346],[11324384.135704042,4423940.935164206],[11325607.128156604,4423940.935164206],[11328053.11306173,4423329.438937925],[11328970.357401151,4423329.438937925],[11331110.594193136,4422717.942711643],[11333556.579098262,4421800.698372222],[11335696.815890245,4420883.454032799],[11337225.55645595,4420577.705919659],[11338142.80079537,4419966.209693378],[11338754.297021652,4419660.461580237],[11339365.793247933,4419354.713467097],[11340588.785700496,4418437.469127675],[11341200.281926777,4418131.721014534],[11341506.030039918,4417825.972901394],[11342117.526266199,4416908.728561971],[11342729.02249248,4416602.980448831],[11343034.77060562,4416297.23233569],[11343340.51871876,4415991.48422255],[11343646.2668319,4415379.987996268],[11343952.014945043,4415074.239883128],[11344563.511171324,4414462.743656847],[11345786.503623886,4412934.003091143],[11346092.251737026,4412628.254978003],[11346703.747963307,4412322.5068648625],[11347315.244189588,4411099.5144123],[11347620.99230273,4410793.766299159],[11348538.236642152,4409876.521959737],[11348843.984755293,4409570.7738465965],[11349455.480981573,4408653.529507175],[11350984.221547278,4407736.285167753],[11351595.717773559,4407430.537054612],[11352512.96211298,4406819.04082833],[11352818.71022612,4406513.29271519],[11353430.206452401,4406207.5446020495],[11354041.702678682,4405901.796488909],[11354347.450791823,4405596.048375769],[11354653.198904965,4405596.048375769],[11355264.695131246,4405596.048375769],[11355876.191357527,4405290.300262628],[11356793.435696948,4405290.300262628],[11358627.924375793,4404678.804036346],[11360768.161167776,4404373.055923206],[11361685.4055072,4404373.055923206],[11367188.87154373,4403455.811583784],[11369634.856448855,4403150.063470643],[11372080.84135398,4402844.315357503],[11375138.322485385,4401927.071018081],[11377890.055503651,4401009.826678659],[11382476.27720076,4399175.337999815],[11383699.269653324,4398258.093660394],[11384922.262105886,4397646.597434112],[11385533.758332167,4397035.101207831],[11385839.506445307,4396729.3530946905],[11386145.254558448,4395812.108755268],[11386145.254558448,4394894.864415847],[11386145.254558448,4394283.368189565],[11386145.254558448,4393060.375737003],[11386145.254558448,4391837.38328444],[11386145.254558448,4390614.3908318775],[11386451.00267159,4388779.902153034],[11386451.00267159,4388168.405926753],[11387062.498897871,4386333.917247909],[11387979.743237292,4383276.436116503],[11388285.491350433,4382664.939890222],[11389508.483802995,4379607.458758815],[11389814.231916137,4378690.214419394],[11389814.231916137,4377161.473853691],[11390731.476255558,4375326.985174847],[11391037.224368699,4374103.992722284],[11391342.97248184,4372575.252156581],[11391342.97248184,4371046.511590878],[11391342.97248184,4370129.267251456],[11391342.97248184,4367377.53423319],[11391342.97248184,4366460.289893769],[11390731.476255558,4364320.053101784],[11389814.231916137,4363097.060649222],[11389202.735689854,4362485.56442294],[11388591.239463573,4361874.068196659],[11388285.491350433,4361568.3200835185],[11386145.254558448,4360039.579517815],[11385839.506445307,4359428.083291534],[11385228.010219026,4359122.335178393],[11384616.513992745,4358816.5870652525],[11383699.269653324,4357899.342725831],[11382476.27720076,4356982.098386409],[11381864.78097448,4356370.602160128],[11379418.796069356,4353924.617255002],[11378195.803616792,4353313.121028721],[11376667.06305109,4353007.372915581],[11375138.322485385,4352395.8766893],[11372386.589467121,4351784.380463018],[11371163.597014558,4351172.884236737],[11369940.604561996,4350867.136123597],[11367188.87154373,4350561.388010456],[11365965.879091168,4350561.388010456],[11364131.390412323,4350561.388010456],[11362602.64984662,4350561.388010456],[11358933.672488933,4350561.388010456],[11357099.183810089,4350561.388010456],[11355570.443244386,4350561.388010456],[11352512.96211298,4350561.388010456],[11351289.969660418,4350561.388010456],[11350066.977207854,4350867.136123597],[11348538.236642152,4350867.136123597],[11347009.496076448,4350867.136123597],[11345786.503623886,4350867.136123597],[11341811.778153058,4351172.884236737],[11340283.037587354,4351172.884236737],[11339060.045134792,4351172.884236737],[11336919.808342809,4351478.632349878],[11335696.815890245,4351478.632349878],[11332945.08287198,4352090.128576159],[11329581.853627432,4352701.62480244],[11327441.616835449,4353313.121028721],[11326218.624382887,4353618.869141862],[11322243.898912057,4354841.861594425],[11321326.654572636,4355453.3578207055],[11320409.410233214,4355759.105933847],[11319186.417780653,4356676.350273268],[11317351.929101808,4357899.342725831],[11316740.432875527,4358205.090838972],[11316434.684762387,4358816.5870652525],[11314294.447970401,4360039.579517815],[11313988.699857261,4360345.327630956],[11313377.20363098,4361262.571970378],[11312154.211178418,4362791.312536081],[11312154.211178418,4363402.808762362],[11311542.714952135,4363708.556875503],[11310931.218725855,4364625.801214925],[11310625.470612714,4365848.793667487],[11310319.722499574,4366154.541780627],[11310013.974386433,4366460.289893769],[11309708.226273293,4367071.78612005],[11309402.478160152,4367377.53423319],[11308790.981933871,4368600.526685753],[11308485.233820729,4368906.274798893],[11308179.485707588,4369517.771025174],[11307567.989481308,4369517.771025174],[11307567.989481308,4369823.519138315],[11306956.493255027,4369823.519138315],[11306344.997028746,4370129.267251456],[11305122.004576184,4370435.015364597],[11304510.508349901,4370740.763477737],[11303899.01212362,4370740.763477737],[11303287.51589734,4370740.763477737],[11302370.271557918,4370740.763477737],[11301147.279105354,4370740.763477737],[11299618.538539652,4370740.763477737],[11296866.805521386,4370740.763477737],[11294420.82061626,4370740.763477737],[11291669.087597996,4371046.511590878],[11290751.843258573,4371352.259704018],[11289528.85080601,4371963.7559303],[11287694.362127168,4372881.000269721],[11287388.614014026,4373186.748382862],[11286471.369674604,4373492.496496003],[11285859.873448323,4373798.244609144],[11285554.125335183,4374715.488948565],[11284025.38476948,4375632.733287987],[11283413.888543198,4376549.977627409],[11283108.140430057,4377161.473853691],[11282496.644203776,4378690.214419394],[11282496.644203776,4379301.710645675],[11282496.644203776,4379913.206871956],[11282496.644203776,4380524.7030982375],[11282802.392316917,4381747.695550799],[11282802.392316917,4382359.191777081],[11283413.888543198,4383276.436116503],[11284025.38476948,4384499.428569065],[11284636.880995762,4385416.672908487],[11285248.377222043,4386333.917247909],[11285554.125335183,4386639.66536105],[11286165.621561464,4387251.1615873305],[11286471.369674604,4387556.909700472],[11286777.117787745,4387862.657813612],[11286777.117787745,4388168.405926753],[11287082.865900885,4388168.405926753],[11287082.865900885,4388474.154039893],[11287082.865900885,4388779.902153034],[11287388.614014026,4389391.398379316],[11293809.32438998,4408959.277620316],[11295032.316842543,4410793.766299159],[11298089.79797395,4415991.48422255],[11298395.54608709,4416297.23233569]]],"symbol":{"type":"esriSFS","color":[150,150,150,51],"outline":{"type":"esriSLS","color":[50,50,50,255],"width":2,"style":"esriSLSSolid"},"style":"esriSFSSolid"}}',
        regionId: null,
        regionName: '11111',
        tollStationList: []
      }
      insertODRegionObject(data).then(res => {
        debugger
      })
      // debugger
      // if (e.index === 0 || e.index) {
      //   const index = e.index
      //   delete e.index
      //   this.tableData.splice(index, 1, e)
      // } else {
      //   this.tableData.unshift(e)
      // }
    },
    getODRegionList() {
      getODRegionList().then(res => {
        // debugger
      })
    },
    getTollStationList() {
      getTollStationList().then(res => {
        this.stationData = res
      })
    }
  }
}
</script>

<style lang="css" scoped>
.container {
  margin: 30px;
}
</style>

